{"ast":null,"code":"import _toConsumableArray from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _createSuper from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import _inherits from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from'react';import{AiFillCaretRight,AiFillCaretDown}from'react-icons/ai';import RawTable from'./RawTable';import{generateTreeData}from'../utils/utils';import*as str from'../utils/strings';import i18n from'../data/i18n.yml';var Table=/*#__PURE__*/function(_Component){_inherits(Table,_Component);var _super=_createSuper(Table);function Table(){var _this;_classCallCheck(this,Table);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.onRowClick=function(row){_this.props.regionToggle(row.original.region.split('.'));};_this.highlightCurrentRegion=function(){document.querySelectorAll('.data-table tr').forEach(function(x){return x.classList.remove('current');});// hack\nsetTimeout(function(){var elem=document.getElementById(\"table-\".concat(_this.props.currentRegion.join('.')));var tbodyElem=document.querySelector('.data-table tbody');// scroll into view if the row is not visible\nif(elem!=null&&tbodyElem!=null){elem.classList.add('current');var bounding=elem.getBoundingClientRect();var tableBounding=tbodyElem.getBoundingClientRect();var isInViewPort=bounding.top>=tableBounding.top&&bounding.bottom<=tableBounding.bottom;if(!isInViewPort)tbodyElem.scrollTop=elem.offsetTop-tbodyElem.offsetTop;}},200);};_this.getInitialSate=function(tableData){var _this$props=_this.props,currentRegion=_this$props.currentRegion,playing=_this$props.playing;if(currentRegion[0]===str.GLOBAL_ZH&&playing)return{};var indices=[];currentRegion.slice(0,currentRegion.length-1).forEach(function(r){var regionData=indices.reduce(function(s,x){return Array.isArray(s)?s[x]:s.subRows[x];},tableData);var subregions=Array.isArray(regionData)?regionData:regionData.subRows;var newIdx=subregions.findIndex(function(x){return x.name===r;});indices.push(newIdx);});var expanded=indices.map(function(x,i){return indices.slice(0,i+1).join('.');}).reduce(function(s,x){s[x]=true;return s;},{});return{expanded:expanded};};return _this;}_createClass(Table,[{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps.currentRegion.join('.')!==this.props.currentRegion.join('.'))this.highlightCurrentRegion();}},{key:\"componentDidMount\",value:function componentDidMount(){this.highlightCurrentRegion();}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps){return nextProps.lang!==this.props.lang||nextProps.date!==this.props.date||nextProps.currentRegion!==this.props.currentRegion;}},{key:\"render\",value:function render(){var _this$props2=this.props,data=_this$props2.data,lang=_this$props2.lang,date=_this$props2.date;if(data==null)return/*#__PURE__*/React.createElement(\"div\",null);var tableData=generateTreeData(data,date,lang,false,'subRows','confirmedCount');var columns=[{// Build our expander column\nid:'expander',// Make sure it has an ID\nHeader:function Header(_ref){var getToggleAllRowsExpandedProps=_ref.getToggleAllRowsExpandedProps,isAllRowsExpanded=_ref.isAllRowsExpanded;return/*#__PURE__*/React.createElement(\"span\",getToggleAllRowsExpandedProps(),isAllRowsExpanded?/*#__PURE__*/React.createElement(AiFillCaretDown,{size:14}):/*#__PURE__*/React.createElement(AiFillCaretRight,{size:14}));},Cell:function Cell(_ref2){var row=_ref2.row;return(// Use the row.canExpand and row.getToggleRowExpandedProps prop getter\n// to build the toggle for expanding a row\nrow.canExpand?/*#__PURE__*/React.createElement(\"span\",row.getToggleRowExpandedProps({style:{// We can even use the row.depth property\n// and paddingLeft to indicate the depth\n// of the row\npaddingLeft:0}}),row.isExpanded?/*#__PURE__*/React.createElement(AiFillCaretDown,{size:14}):/*#__PURE__*/React.createElement(AiFillCaretRight,{size:14})):null);}},{Header:i18n.REGION[lang],Cell:function Cell(_ref3){var row=_ref3.row;return/*#__PURE__*/React.createElement(\"span\",null,\"\".concat(_toConsumableArray(Array(row.depth+1).keys()).map(function(x){return'ã€€';}).join('')).concat(row.original.displayName));},accessor:'displayName'},{Header:i18n.CONFIRMED[lang],accessor:'confirmedCount'},{Header:i18n.RECOVERED[lang],accessor:'curedCount'},{Header:i18n.DEATHS[lang],accessor:'deadCount'}];var initialState=this.getInitialSate(tableData);return/*#__PURE__*/React.createElement(\"div\",{style:{height:'100%'}},/*#__PURE__*/React.createElement(RawTable,{columns:columns,data:tableData,initialState:initialState,onRowClick:this.onRowClick,filterPlaceholder:\"\".concat(i18n.SEARCH[lang],\" ...\")}));}}]);return Table;}(Component);export{Table as default};","map":{"version":3,"sources":["D:/programming/react/new covid/covid19/src/components/Table.js"],"names":["React","Component","AiFillCaretRight","AiFillCaretDown","RawTable","generateTreeData","str","i18n","Table","onRowClick","row","props","regionToggle","original","region","split","highlightCurrentRegion","document","querySelectorAll","forEach","x","classList","remove","setTimeout","elem","getElementById","currentRegion","join","tbodyElem","querySelector","add","bounding","getBoundingClientRect","tableBounding","isInViewPort","top","bottom","scrollTop","offsetTop","getInitialSate","tableData","playing","GLOBAL_ZH","indices","slice","length","r","regionData","reduce","s","Array","isArray","subRows","subregions","newIdx","findIndex","name","push","expanded","map","i","prevProps","nextProps","lang","date","data","columns","id","Header","getToggleAllRowsExpandedProps","isAllRowsExpanded","Cell","canExpand","getToggleRowExpandedProps","style","paddingLeft","isExpanded","REGION","depth","keys","displayName","accessor","CONFIRMED","RECOVERED","DEATHS","initialState","height","SEARCH"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { AiFillCaretRight, AiFillCaretDown } from 'react-icons/ai'\r\nimport RawTable from './RawTable'\r\nimport { generateTreeData } from '../utils/utils'\r\nimport * as str from '../utils/strings'\r\nimport i18n from '../data/i18n.yml'\r\n\r\nexport default class Table extends Component {\r\n    onRowClick = (row) => {\r\n        this.props.regionToggle(row.original.region.split('.'))\r\n    }\r\n\r\n    highlightCurrentRegion = () => {\r\n        document.querySelectorAll('.data-table tr').forEach((x) => x.classList.remove('current'))\r\n        // hack\r\n        setTimeout(() => {\r\n            const elem = document.getElementById(`table-${this.props.currentRegion.join('.')}`)\r\n            const tbodyElem = document.querySelector('.data-table tbody')\r\n\r\n            // scroll into view if the row is not visible\r\n            if (elem != null && tbodyElem != null) {\r\n                elem.classList.add('current')\r\n                const bounding = elem.getBoundingClientRect()\r\n                const tableBounding = tbodyElem.getBoundingClientRect()\r\n                const isInViewPort = bounding.top >= tableBounding.top && bounding.bottom <= tableBounding.bottom\r\n\r\n                if (!isInViewPort) tbodyElem.scrollTop = elem.offsetTop - tbodyElem.offsetTop\r\n            }\r\n        }, 200)\r\n    }\r\n\r\n    getInitialSate = (tableData) => {\r\n        const { currentRegion, playing } = this.props\r\n        if (currentRegion[0] === str.GLOBAL_ZH && playing) return {}\r\n\r\n        let indices = []\r\n        currentRegion.slice(0, currentRegion.length - 1).forEach((r) => {\r\n            const regionData = indices.reduce((s, x) => (Array.isArray(s) ? s[x] : s.subRows[x]), tableData)\r\n            const subregions = Array.isArray(regionData) ? regionData : regionData.subRows\r\n            const newIdx = subregions.findIndex((x) => x.name === r)\r\n            indices.push(newIdx)\r\n        })\r\n        const expanded = indices.map((x, i) => indices.slice(0, i + 1).join('.')).reduce((s, x) => {\r\n            s[x] = true\r\n            return s\r\n        }, {})\r\n\r\n        return {\r\n            expanded\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        if (prevProps.currentRegion.join('.') !== this.props.currentRegion.join('.')) this.highlightCurrentRegion()\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.highlightCurrentRegion()\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps) {\r\n        return (\r\n            nextProps.lang !== this.props.lang ||\r\n            nextProps.date !== this.props.date ||\r\n            nextProps.currentRegion !== this.props.currentRegion\r\n        )\r\n    }\r\n\r\n    render() {\r\n        const { data, lang, date } = this.props\r\n        if (data == null) return <div />\r\n        const tableData = generateTreeData(data, date, lang, false, 'subRows', 'confirmedCount')\r\n\r\n        const columns = [\r\n            {\r\n                // Build our expander column\r\n                id: 'expander', // Make sure it has an ID\r\n                Header: ({ getToggleAllRowsExpandedProps, isAllRowsExpanded }) => (\r\n                    <span {...getToggleAllRowsExpandedProps()}>\r\n                        {isAllRowsExpanded ? <AiFillCaretDown size={14} /> : <AiFillCaretRight size={14} />}\r\n                    </span>\r\n                ),\r\n                Cell: ({ row }) =>\r\n                    // Use the row.canExpand and row.getToggleRowExpandedProps prop getter\r\n                    // to build the toggle for expanding a row\r\n                    row.canExpand ? (\r\n                        <span\r\n                            {...row.getToggleRowExpandedProps({\r\n                                style: {\r\n                                    // We can even use the row.depth property\r\n                                    // and paddingLeft to indicate the depth\r\n                                    // of the row\r\n                                    paddingLeft: 0\r\n                                }\r\n                            })}\r\n                        >\r\n                            {row.isExpanded ? <AiFillCaretDown size={14} /> : <AiFillCaretRight size={14} />}\r\n                        </span>\r\n                    ) : null\r\n            },\r\n            {\r\n                Header: i18n.REGION[lang],\r\n                Cell: ({ row }) => {\r\n                    return (\r\n                        <span>{`${[ ...Array(row.depth + 1).keys() ].map((x) => 'ã€€').join('')}${row.original\r\n                            .displayName}`}</span>\r\n                    )\r\n                },\r\n                accessor: 'displayName'\r\n            },\r\n            {\r\n                Header: i18n.CONFIRMED[lang],\r\n                accessor: 'confirmedCount'\r\n            },\r\n            {\r\n                Header: i18n.RECOVERED[lang],\r\n                accessor: 'curedCount'\r\n            },\r\n            {\r\n                Header: i18n.DEATHS[lang],\r\n                accessor: 'deadCount'\r\n            }\r\n        ]\r\n\r\n        const initialState = this.getInitialSate(tableData)\r\n\r\n        return (\r\n            <div style={{ height: '100%' }}>\r\n                <RawTable\r\n                    columns={columns}\r\n                    data={tableData}\r\n                    initialState={initialState}\r\n                    onRowClick={this.onRowClick}\r\n                    filterPlaceholder={`${i18n.SEARCH[lang]} ...`}\r\n                />\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}