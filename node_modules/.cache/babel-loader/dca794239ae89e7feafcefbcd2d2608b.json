{"ast":null,"code":"var _jsxFileName = \"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\src\\\\components\\\\Plot.js\";\nimport React, { Component } from 'react';\nimport { AiOutlineFullscreen, AiOutlineFullscreenExit } from 'react-icons/ai';\nimport { isMobile, isIPad13 } from 'react-device-detect';\nimport PlotSelector from './PlotSelector';\nimport PlotNavBar from './PlotNavBar';\nimport LinePlot from './LinePlot';\nimport StreamPlot from './StreamPlot';\nimport BumpPlot from './BumpPlot';\nimport { generatePlotData } from '../utils/plot_data';\nimport { getDataFromRegion } from '../utils/utils';\nimport { plotTypes, plotSpecificTypes, getSpecificPlotType } from '../utils/plot_types';\nimport * as str from '../utils/strings';\nimport i18n from '../data/i18n.yml';\n\nconst plotTheme = (darkMode, fullMode) => {\n  return {\n    fontFamily: 'Saira, sans-serif',\n    fontSize: fullMode ? 14 : 11,\n    textColor: darkMode ? 'var(--lighter-grey)' : 'black',\n    grid: {\n      line: {\n        stroke: darkMode ? 'var(--darkest-grey)' : 'var(--lighter-grey)'\n      }\n    },\n    tooltip: {\n      container: {\n        background: darkMode ? 'var(--darkest-grey)' : 'white',\n        color: darkMode ? 'var(--lighter-grey)' : 'black'\n      }\n    }\n  };\n};\n\nexport default class Plot extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      height: 290,\n      plotDetails: {\n        stats: 'cumulative',\n        fatalityLine: 'rate',\n        stream: 'silhouette',\n        diseaseComparison: 'show',\n        recoveryRate: 'show',\n        movingAverage: '1d'\n      },\n      plotSpecificType: 'total'\n    };\n\n    this.updateHight = () => {\n      const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n      const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);\n      this.setState({\n        height: vh < 850 && vw >= 992 ? 240 : 290\n      });\n    };\n\n    this.onSelect = (s, v) => {\n      let state = {};\n      state.plotDetails = this.state.plotDetails;\n      state.plotDetails[s] = v;\n      this.setState(state);\n      this.setSpecificPlotType(this.props.plotType, state.plotDetails);\n    };\n\n    this.setSpecificPlotType = (plotType, plotDetails) => {\n      const specificType = getSpecificPlotType(plotType, plotDetails);\n      this.setState({\n        plotSpecificType: specificType\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.updateHight();\n    window.addEventListener('resize', this.updateHight);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateHight);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      data,\n      currentRegion\n    } = this.props;\n    const currentRegionIsGlobal = currentRegion.length === 1 && currentRegion[0] === str.GLOBAL_ZH;\n    const hasSubregions = Object.keys(getDataFromRegion(data, currentRegion)).length > 4 || currentRegionIsGlobal;\n\n    if (currentRegionIsGlobal && this.props.plotType === 'plot_one_vs_rest') {\n      this.props.handlePlotTypeChange('plot_basic');\n      this.setSpecificPlotType('plot_basic', this.state.plotDetails);\n    }\n\n    if (!hasSubregions && plotTypes[this.props.plotType].subregions) {\n      this.props.handlePlotTypeChange('plot_basic');\n      this.setSpecificPlotType('plot_basic', this.state.plotDetails);\n    }\n  }\n\n  render() {\n    const {\n      plotType,\n      data,\n      lang,\n      darkMode,\n      fullPlot,\n      fullPlotToggle,\n      fullDimensions\n    } = this.props;\n    if (data == null) return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 34\n      }\n    });\n    const plotParameters = plotSpecificTypes[this.state.plotSpecificType];\n    const plotDataAll = generatePlotData({ ...this.props,\n      plotSpecificType: this.state.plotSpecificType,\n      plotDetails: this.state.plotDetails\n    });\n    const plotData = plotDataAll.plotData;\n    const isDataEmpty = !['plot_subregion_active_stream', 'plot_subregion_stream'].includes(plotType) ? plotData.map(d => d.data.length).reduce((s, x) => s + x, 0) === 0 : plotData.map(d => Object.keys(d).length).reduce((s, x) => s + x, 0) === 0;\n    const tickValues = isDataEmpty ? 0 : plotDataAll.tickValues != null ? plotDataAll.tickValues : 5;\n    const FullScreenIcon = fullPlot ? AiOutlineFullscreenExit : AiOutlineFullscreen;\n    const plotProps = { ...this.props,\n      plotParameters,\n      plotDataAll,\n      tickValues,\n      plotTheme: plotTheme(darkMode, fullPlot)\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"plot-wrap\",\n      style: {\n        height: !fullPlot ? 'auto' : fullDimensions.height - 100,\n        width: !fullPlot ? '100%' : fullDimensions.width + 100\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(PlotSelector, Object.assign({}, this.props, this.state, {\n      currentPlotType: plotType,\n      onPlotTypeChange: plotType => {\n        this.setSpecificPlotType(plotType, this.state.plotDetails);\n        this.props.handlePlotTypeChange(plotType);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"plot-with-nav-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(PlotNavBar, Object.assign({}, this.props, this.state, {\n      onSelect: this.onSelect,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        height: !fullPlot ? this.state.height : fullDimensions.height - 125,\n        width: !fullPlot ? '100%' : fullDimensions.width - 70\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 21\n      }\n    }, isDataEmpty ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"plot-no-data\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 33\n      }\n    }, i18n.NO_DATA[lang])) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 29\n      }\n    }), !isDataEmpty && /*#__PURE__*/React.createElement(LinePlot, Object.assign({}, plotProps, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 42\n      }\n    })), !isDataEmpty && /*#__PURE__*/React.createElement(BumpPlot, Object.assign({}, plotProps, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 42\n      }\n    })), !isDataEmpty && /*#__PURE__*/React.createElement(StreamPlot, Object.assign({\n      offsetType: this.state.plotDetails.stream\n    }, plotProps, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 42\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"plot-full-button\",\n      \"data-tip\": !fullPlot && !isMobile && !isIPad13 ? i18n.PLOT_SETTINGS[lang] : '',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(FullScreenIcon, {\n      size: fullPlot ? 30 : 20,\n      onClick: fullPlotToggle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 29\n      }\n    })))));\n  }\n\n}","map":{"version":3,"sources":["D:/programming/react/new covid/covid19/src/components/Plot.js"],"names":["React","Component","AiOutlineFullscreen","AiOutlineFullscreenExit","isMobile","isIPad13","PlotSelector","PlotNavBar","LinePlot","StreamPlot","BumpPlot","generatePlotData","getDataFromRegion","plotTypes","plotSpecificTypes","getSpecificPlotType","str","i18n","plotTheme","darkMode","fullMode","fontFamily","fontSize","textColor","grid","line","stroke","tooltip","container","background","color","Plot","state","height","plotDetails","stats","fatalityLine","stream","diseaseComparison","recoveryRate","movingAverage","plotSpecificType","updateHight","vh","Math","max","document","documentElement","clientHeight","window","innerHeight","vw","clientWidth","innerWidth","setState","onSelect","s","v","setSpecificPlotType","props","plotType","specificType","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","componentDidUpdate","prevProps","prevState","data","currentRegion","currentRegionIsGlobal","length","GLOBAL_ZH","hasSubregions","Object","keys","handlePlotTypeChange","subregions","render","lang","fullPlot","fullPlotToggle","fullDimensions","plotParameters","plotDataAll","plotData","isDataEmpty","includes","map","d","reduce","x","tickValues","FullScreenIcon","plotProps","width","NO_DATA","PLOT_SETTINGS"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { AiOutlineFullscreen, AiOutlineFullscreenExit } from 'react-icons/ai'\r\nimport { isMobile, isIPad13 } from 'react-device-detect'\r\nimport PlotSelector from './PlotSelector'\r\nimport PlotNavBar from './PlotNavBar'\r\nimport LinePlot from './LinePlot'\r\nimport StreamPlot from './StreamPlot'\r\nimport BumpPlot from './BumpPlot'\r\nimport { generatePlotData } from '../utils/plot_data'\r\nimport { getDataFromRegion } from '../utils/utils'\r\nimport { plotTypes, plotSpecificTypes, getSpecificPlotType } from '../utils/plot_types'\r\nimport * as str from '../utils/strings'\r\nimport i18n from '../data/i18n.yml'\r\n\r\nconst plotTheme = (darkMode, fullMode) => {\r\n    return {\r\n        fontFamily: 'Saira, sans-serif',\r\n        fontSize: fullMode ? 14 : 11,\r\n        textColor: darkMode ? 'var(--lighter-grey)' : 'black',\r\n        grid: {\r\n            line: {\r\n                stroke: darkMode ? 'var(--darkest-grey)' : 'var(--lighter-grey)'\r\n            }\r\n        },\r\n        tooltip: {\r\n            container: {\r\n                background: darkMode ? 'var(--darkest-grey)' : 'white',\r\n                color: darkMode ? 'var(--lighter-grey)' : 'black'\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default class Plot extends Component {\r\n    state = {\r\n        height: 290,\r\n        plotDetails: {\r\n            stats: 'cumulative',\r\n            fatalityLine: 'rate',\r\n            stream: 'silhouette',\r\n            diseaseComparison: 'show',\r\n            recoveryRate: 'show',\r\n            movingAverage: '1d'\r\n        },\r\n        plotSpecificType: 'total'\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.updateHight()\r\n        window.addEventListener('resize', this.updateHight)\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        window.removeEventListener('resize', this.updateHight)\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        const { data, currentRegion } = this.props\r\n        const currentRegionIsGlobal = currentRegion.length === 1 && currentRegion[0] === str.GLOBAL_ZH\r\n        const hasSubregions = Object.keys(getDataFromRegion(data, currentRegion)).length > 4 || currentRegionIsGlobal\r\n\r\n        if (currentRegionIsGlobal && this.props.plotType === 'plot_one_vs_rest') {\r\n            this.props.handlePlotTypeChange('plot_basic')\r\n            this.setSpecificPlotType('plot_basic', this.state.plotDetails)\r\n        }\r\n\r\n        if (!hasSubregions && plotTypes[this.props.plotType].subregions) {\r\n            this.props.handlePlotTypeChange('plot_basic')\r\n            this.setSpecificPlotType('plot_basic', this.state.plotDetails)\r\n        }\r\n    }\r\n\r\n    updateHight = () => {\r\n        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0)\r\n        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)\r\n\r\n        this.setState({\r\n            height: vh < 850 && vw >= 992 ? 240 : 290\r\n        })\r\n    }\r\n\r\n    onSelect = (s, v) => {\r\n        let state = {}\r\n        state.plotDetails = this.state.plotDetails\r\n        state.plotDetails[s] = v\r\n\r\n        this.setState(state)\r\n        this.setSpecificPlotType(this.props.plotType, state.plotDetails)\r\n    }\r\n\r\n    setSpecificPlotType = (plotType, plotDetails) => {\r\n        const specificType = getSpecificPlotType(plotType, plotDetails)\r\n\r\n        this.setState({ plotSpecificType: specificType })\r\n    }\r\n\r\n    render() {\r\n        const { plotType, data, lang, darkMode, fullPlot, fullPlotToggle, fullDimensions } = this.props\r\n\r\n        if (data == null) return <div />\r\n\r\n        const plotParameters = plotSpecificTypes[this.state.plotSpecificType]\r\n        const plotDataAll = generatePlotData({\r\n            ...this.props,\r\n            plotSpecificType: this.state.plotSpecificType,\r\n            plotDetails: this.state.plotDetails\r\n        })\r\n        const plotData = plotDataAll.plotData\r\n\r\n        const isDataEmpty = ![ 'plot_subregion_active_stream', 'plot_subregion_stream' ].includes(plotType)\r\n            ? plotData.map((d) => d.data.length).reduce((s, x) => s + x, 0) === 0\r\n            : plotData.map((d) => Object.keys(d).length).reduce((s, x) => s + x, 0) === 0\r\n\r\n        const tickValues = isDataEmpty ? 0 : plotDataAll.tickValues != null ? plotDataAll.tickValues : 5\r\n\r\n        const FullScreenIcon = fullPlot ? AiOutlineFullscreenExit : AiOutlineFullscreen\r\n\r\n        const plotProps = {\r\n            ...this.props,\r\n            plotParameters,\r\n            plotDataAll,\r\n            tickValues,\r\n            plotTheme: plotTheme(darkMode, fullPlot)\r\n        }\r\n\r\n        return (\r\n            <div\r\n                className=\"plot-wrap\"\r\n                style={{\r\n                    height: !fullPlot ? 'auto' : fullDimensions.height - 100,\r\n                    width: !fullPlot ? '100%' : fullDimensions.width + 100\r\n                }}\r\n            >\r\n                <PlotSelector\r\n                    {...this.props}\r\n                    {...this.state}\r\n                    currentPlotType={plotType}\r\n                    onPlotTypeChange={(plotType) => {\r\n                        this.setSpecificPlotType(plotType, this.state.plotDetails)\r\n                        this.props.handlePlotTypeChange(plotType)\r\n                    }}\r\n                />\r\n                <div className=\"plot-with-nav-bar\">\r\n                    <PlotNavBar {...this.props} {...this.state} onSelect={this.onSelect} />\r\n                    <div\r\n                        style={{\r\n                            height: !fullPlot ? this.state.height : fullDimensions.height - 125,\r\n                            width: !fullPlot ? '100%' : fullDimensions.width - 70\r\n                        }}\r\n                    >\r\n                        {isDataEmpty ? (\r\n                            <div className=\"plot-no-data\">\r\n                                <span>{i18n.NO_DATA[lang]}</span>\r\n                            </div>\r\n                        ) : (\r\n                            <div />\r\n                        )}\r\n                        {!isDataEmpty && <LinePlot {...plotProps} />}\r\n                        {!isDataEmpty && <BumpPlot {...plotProps} />}\r\n                        {!isDataEmpty && <StreamPlot offsetType={this.state.plotDetails.stream} {...plotProps} />}\r\n                        <div\r\n                            className=\"plot-full-button\"\r\n                            data-tip={!fullPlot && !isMobile && !isIPad13 ? i18n.PLOT_SETTINGS[lang] : ''}\r\n                        >\r\n                            <FullScreenIcon size={fullPlot ? 30 : 20} onClick={fullPlotToggle} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}