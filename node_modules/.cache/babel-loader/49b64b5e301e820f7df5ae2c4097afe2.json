{"ast":null,"code":"import _toConsumableArray from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:\\\\programming\\\\react\\\\new covid\\\\covid19\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{getDataFromRegion,metricText,parseDate,simplifyName}from'./utils';import*as str from'./strings';import{plotSpecificTypes}from'./plot_types';import i18n from'../data/i18n.yml';import diseases from'../data/other_diseases_stats.yml';export var generatePlotData=function generatePlotData(params){return generatePlotDataFunc[params.plotSpecificType](params);};var metricColors={confirmedCount:'var(--primary-color-4)',deadCount:'var(--primary-color-10)',curedCount:'var(--primary-color-2)'};var metricColorsDark={confirmedCount:'var(--primary-color-4)',deadCount:'var(--lighter-grey)',curedCount:'var(--primary-color-2)'};var generatePlotDataTotal=function generatePlotDataTotal(_ref){var data=_ref.data,date=_ref.date,currentRegion=_ref.currentRegion,lang=_ref.lang,darkMode=_ref.darkMode,playing=_ref.playing,scale=_ref.scale,plotSpecificType=_ref.plotSpecificType,plotDetails=_ref.plotDetails,plotDates=_ref.plotDates,fullPlot=_ref.fullPlot;var fullData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var maxValue=0;var minValue=100000;var plotData=['deadCount','curedCount','confirmedCount'].map(function(metric){var counts=getDataFromRegion(data,currentRegion)[metric];return{id:metricText[metric][lang],color:darkMode?metricColorsDark[metric]:metricColors[metric],data:Object.keys(counts).sort(function(a,b){return parseDate(a)>parseDate(b)?1:-1;}).filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).map(function(d){if(counts[d]>maxValue)maxValue=counts[d];if(counts[d]<minValue)minValue=counts[d];return scale==='linear'||counts[d]>0?{x:d,y:counts[d]}:null;}).filter(function(x){return x!=null;})};});plotData=calcMovingAverage(plotData,plotDetails.movingAverage);if(!fullData)plotData=applyDateRange(plotData,plotDates);return _objectSpread({plotData:plotData},getTickValues(scale,plotSpecificType,fullPlot,minValue,maxValue));};var generatePlotDataNew=function generatePlotDataNew(params){var fullData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _generatePlotDataTota=generatePlotDataTotal(params,true),plotData=_generatePlotDataTota.plotData;plotData=convertTotalToNew(plotData);if(!fullData)plotData=applyDateRange(plotData,params.plotDates);return{plotData:plotData};};var generatePlotDataGrowthRate=function generatePlotDataGrowthRate(params){var _ref2=params.plotSpecificType==='growth_total'?generatePlotDataTotal(params,true):generatePlotDataNew(params,true),plotData=_ref2.plotData;var metric=params.metric;plotData.forEach(function(metricData){metricData.data=metricData.data.reduce(function(s,v,i){return[].concat(_toConsumableArray(s),[metricData.data[i-1]&&metricData.data[i-1].y>0?_objectSpread({},v,{y:(v.y-metricData.data[i-1].y)/metricData.data[i-1].y}):_objectSpread({},v,{y:0})]);},[]);});if(metric==='confirmedCount')plotData=[plotData[2]];if(metric==='curedCount')plotData=[plotData[1]];if(metric==='deadCount')plotData=[plotData[0]];plotData=applyDateRange(plotData,params.plotDates);return{plotData:plotData};};var generatePlotDataRate=function generatePlotDataRate(_ref3){var data=_ref3.data,currentRegion=_ref3.currentRegion,darkMode=_ref3.darkMode,lang=_ref3.lang,date=_ref3.date,playing=_ref3.playing,plotDetails=_ref3.plotDetails,plotDates=_ref3.plotDates;var confirmedCounts=getDataFromRegion(data,currentRegion)['confirmedCount'];var metrics=plotDetails.recoveryRate==='show'?['deadCount','curedCount']:['deadCount'];var plotData=metrics.map(function(metric){var counts=getDataFromRegion(data,currentRegion)[metric];var newMetric=metric==='deadCount'?'fatalityRate':'recoveryRate';return{id:metricText[newMetric][lang],color:darkMode?metricColorsDark[metric]:metricColors[metric],data:Object.keys(counts).filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).map(function(d){return{d:d,count:confirmedCounts[d]>0?counts[d]/confirmedCounts[d]:0};}).map(function(_ref4){var d=_ref4.d,count=_ref4.count;return{x:d,y:count};})};});plotData=calcMovingAverage(plotData,plotDetails.movingAverage);plotData=applyDateRange(plotData,plotDates);return{plotData:plotData};};var generatePlotDataOneVsRest=function generatePlotDataOneVsRest(_ref5){var data=_ref5.data,currentRegion=_ref5.currentRegion,metric=_ref5.metric,lang=_ref5.lang,date=_ref5.date,playing=_ref5.playing,scale=_ref5.scale,plotSpecificType=_ref5.plotSpecificType,plotDetails=_ref5.plotDetails,plotDates=_ref5.plotDates,fullPlot=_ref5.fullPlot;var maxValue=0;var minValue=100000;var currentData=getDataFromRegion(data,currentRegion);var counts=currentData[metric];var regionName=lang==='zh'?currentRegion[currentRegion.length-1]:currentData.ENGLISH;regionName=simplifyName(regionName,lang);var parentRegion=currentRegion.length===1?[str.GLOBAL_ZH]:currentRegion.slice(0,currentRegion.length-1);var parentData=getDataFromRegion(data,parentRegion);var parentCounts=parentData[metric];var parentRegionName=lang==='zh'?parentRegion[parentRegion.length-1]:parentData.ENGLISH;parentRegionName=simplifyName(parentRegionName,lang);var plotData=[];var parentPlotData={id:lang==='zh'?\"\".concat(parentRegionName,\" (\").concat(i18n.REST[lang],\")\"):\"\".concat(i18n.REST[lang],\" of \").concat(parentRegionName),color:'var(--primary-color-4)',data:Object.keys(parentCounts).filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).map(function(d){if(counts[d]==null)return null;if(parentCounts[d]-counts[d]>maxValue)maxValue=parentCounts[d]-counts[d];if(parentCounts[d]-counts[d]<minValue)minValue=parentCounts[d]-counts[d];return scale==='linear'||parentCounts[d]-counts[d]>0?{x:d,y:parentCounts[d]-counts[d]}:null;}).filter(function(x){return x!=null;})};var currentPlotData={id:regionName,color:'var(--primary-color-2)',data:Object.keys(counts).filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).map(function(d){if(parentCounts[d]==null)return null;if(counts[d]>maxValue)maxValue=counts[d];if(counts[d]<minValue)minValue=counts[d];return scale==='linear'||counts[d]>0?{x:d,y:counts[d]}:null;}).filter(function(x){return x!=null;})};plotData.push(parentPlotData);plotData.push(currentPlotData);if(plotSpecificType==='one_vs_rest_new'){plotData=convertTotalToNew(plotData);}plotData=calcMovingAverage(plotData,plotDetails.movingAverage);plotData=applyDateRange(plotData,plotDates);return _objectSpread({plotData:plotData},getTickValues(scale,plotSpecificType,fullPlot,minValue,maxValue));};var generatePlotDataSubregionRankings=function generatePlotDataSubregionRankings(_ref6){var data=_ref6.data,currentRegion=_ref6.currentRegion,metric=_ref6.metric,lang=_ref6.lang,darkMode=_ref6.darkMode,playing=_ref6.playing,date=_ref6.date,plotDates=_ref6.plotDates,plotSpecificType=_ref6.plotSpecificType;var currentData=getCurrentData(data,currentRegion);var subregions=playing?getSubregions(data,currentRegion,metric,10):getSubregions(data,currentRegion,metric,10,date);var regionIndices={};var dates=[];var plotData=subregions.map(function(region,i){dates=[].concat(_toConsumableArray(dates),_toConsumableArray(Object.keys(currentData[region][metric])));dates=_toConsumableArray(new Set(dates));regionIndices[region]=i;return region;}).map(function(region,i){var id=lang==='zh'?region:currentData[region].ENGLISH;var dd=Object.keys(currentData[region][metric]).sort(function(a,b){return parseDate(a)>parseDate(b)?1:-1;}).filter(function(d){return parseDate(d)<=parseDate(date);}).filter(function(d){return parseDate(d)<=parseDate(plotDates[1])&&parseDate(d)>=parseDate(plotDates[0]);});var counts=dd.map(function(d){return currentData[region][metric][d];});var count=counts[counts.length-1];if(plotSpecificType==='most_affected_subregions_new')count=counts.length>=2?counts[counts.length-1]-counts[counts.length-2]:counts[counts.length-1];return{id:simplifyName(id,lang),fullId:id,name:region,color:darkMode?\"var(--primary-color-\".concat(i<7?i:i+1,\")\"):\"var(--primary-color-\".concat(10-i,\")\"),count:count,data:[]};});dates=dates.sort(function(a,b){return parseDate(a)>parseDate(b)?1:-1;});var regionSkipped={};dates.filter(function(d){return parseDate(d)<=parseDate(date);}).filter(function(d){return parseDate(d)<=parseDate(plotDates[1])&&parseDate(d)>=parseDate(plotDates[0]);}).forEach(function(d,i){var regionCounts=[];plotData.forEach(function(region){var counts=currentData[region.name][metric][d]?currentData[region.name][metric][d]:0;if(plotSpecificType==='most_affected_subregions_new'){if(i>0&&currentData[region.name][metric][dates[i-1]])counts=counts-currentData[region.name][metric][dates[i-1]];}regionCounts.push({region:region.name,counts:counts});});regionCounts=regionCounts.sort(function(a,b){return a.counts<=b.counts?1:-1;});regionCounts.forEach(function(region,i){if(region.counts===0&&regionSkipped[region.region]==null){plotData[regionIndices[region.region]].data.push({x:d,y:null});}else{regionSkipped[region.region]=true;plotData[regionIndices[region.region]].data.push({x:d,y:i+1});}});});return{plotData:plotData,dates:dates};};var generatePlotDataSubregionStream=function generatePlotDataSubregionStream(_ref7){var data=_ref7.data,currentRegion=_ref7.currentRegion,lang=_ref7.lang,playing=_ref7.playing,date=_ref7.date,plotDates=_ref7.plotDates,metric=_ref7.metric,plotSpecificType=_ref7.plotSpecificType,fullPlot=_ref7.fullPlot;var currentData=getCurrentData(data,currentRegion);var dates=[];var plotData=[];var sortBy=plotSpecificType==='subregion_active_stream'?'confirmedCount':metric;var numOfRegions=!fullPlot?5:9;var subregionsData=getSubregions(data,currentRegion,sortBy,numOfRegions).map(function(region){dates=[].concat(_toConsumableArray(dates),_toConsumableArray(Object.keys(currentData[region]['confirmedCount'])));dates=_toConsumableArray(new Set(dates));return region;}).map(function(region){var id=lang==='zh'?region:currentData[region].ENGLISH;return{id:simplifyName(id,lang),fullId:id,name:region};});var plotKeys=subregionsData.map(function(x){return x.id;});// at least (numOfRegions + 1) subregions\nif(Object.keys(currentData).length>=numOfRegions+5)plotKeys=[].concat(_toConsumableArray(plotKeys),[i18n.OTHERS[lang]]);plotKeys=plotKeys.reverse();dates=dates.sort(function(a,b){return parseDate(a)>parseDate(b)?1:-1;});dates=dates.filter(function(d){return parseDate(d)<=parseDate(plotDates[1])&&parseDate(d)>=parseDate(plotDates[0]);});// no subregions\nif(subregionsData.length===0){dates=Object.keys(currentData['confirmedCount']).sort(function(a,b){return parseDate(a)>parseDate(b)?1:-1;});var id=lang==='zh'?currentRegion[currentRegion.length-1]:currentData.ENGLISH;id=simplifyName(id,lang);plotKeys=[id];}dates.filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).forEach(function(d,i){var subregionCounts={};subregionsData.forEach(function(region){if(plotSpecificType==='subregion_active_stream'){var confirmedCount=currentData[region.name]['confirmedCount'][d]?currentData[region.name]['confirmedCount'][d]:0;var deadCount=currentData[region.name]['deadCount'][d]?currentData[region.name]['deadCount'][d]:0;var curedCount=currentData[region.name]['curedCount'][d]?currentData[region.name]['curedCount'][d]:0;var remainingConfirmed=Math.max(confirmedCount-deadCount-curedCount,0);subregionCounts[region.id]=remainingConfirmed;}else{var count=currentData[region.name][metric][d]?currentData[region.name][metric][d]:0;if(plotSpecificType==='subregion_new_stream'&&currentData[region.name][metric][dates[i-1]])count-=currentData[region.name][metric][dates[i-1]];subregionCounts[region.id]=count;}});var otherConfirmedCount=0;var otherDeadCount=0;var otherCuredCount=0;// compute number of remaining confirmed cases from non-top-5 subregions\nObject.keys(currentData).filter(function(region){return!['confirmedCount','deadCount','curedCount','ENGLISH',str.GLOBAL_ZH].includes(region);}).filter(function(region){return!subregionsData.map(function(x){return x.name;}).includes(region);}).forEach(function(region){var confirmedCount=currentData[region]['confirmedCount'][d]?currentData[region]['confirmedCount'][d]:0;var deadCount=currentData[region]['deadCount'][d]?currentData[region]['deadCount'][d]:0;var curedCount=currentData[region]['curedCount'][d]?currentData[region]['curedCount'][d]:0;otherConfirmedCount+=confirmedCount;otherDeadCount+=deadCount;otherCuredCount+=curedCount;if(plotSpecificType==='subregion_new_stream'){var confirmedCountPrevious=currentData[region]['confirmedCount'][dates[i-1]]?currentData[region]['confirmedCount'][dates[i-1]]:0;var deadCountPrevious=currentData[region]['deadCount'][dates[i-1]]?currentData[region]['deadCount'][dates[i-1]]:0;var curedCountPrevious=currentData[region]['curedCount'][dates[i-1]]?currentData[region]['curedCount'][dates[i-1]]:0;otherConfirmedCount-=confirmedCountPrevious;otherDeadCount-=deadCountPrevious;otherCuredCount-=curedCountPrevious;}});var otherCount=0;if(metric==='confirmedCount')otherCount=Math.max(otherConfirmedCount,0);if(metric==='deadCount')otherCount=Math.max(otherDeadCount,0);if(metric==='curedCount')otherCount=Math.max(otherCuredCount,0);if(plotSpecificType==='subregion_active_stream')otherCount=Math.max(otherConfirmedCount-otherDeadCount-otherCuredCount,0);if(Object.keys(currentData).length>=10)subregionCounts[i18n.OTHERS[lang]]=otherCount;// no subregions\nif(subregionsData.length===0){var confirmedCount=currentData['confirmedCount'][d]?currentData['confirmedCount'][d]:0;var deadCount=currentData['deadCount'][d]?currentData['deadCount'][d]:0;var curedCount=currentData['curedCount'][d]?currentData['curedCount'][d]:0;var remainingConfirmed=Math.max(confirmedCount-deadCount-curedCount,0);var _id=lang==='zh'?currentRegion[currentRegion.length-1]:currentData.ENGLISH;_id=simplifyName(_id,lang);subregionCounts[_id]=plotSpecificType==='subregion_active_stream'?remainingConfirmed:Math.max(currentData[metric][d]?currentData[metric][d]:0,0);}plotData.push(subregionCounts);});return{plotData:plotData,dates:dates,plotKeys:plotKeys};};var generatePlotDataFatalityLine=function generatePlotDataFatalityLine(_ref8){var data=_ref8.data,currentRegion=_ref8.currentRegion,date=_ref8.date,darkMode=_ref8.darkMode,lang=_ref8.lang,plotSpecificType=_ref8.plotSpecificType,plotDates=_ref8.plotDates;var confirmedCount=getDataFromRegion(data,currentRegion)['confirmedCount'];var deadCount=getDataFromRegion(data,currentRegion)['deadCount'];var plotData=[{id:'fatality-line',color:darkMode?'var(--primary-color-2)':'var(--primary-color-5)',data:Object.keys(confirmedCount).filter(function(d){return parseDate(d)<=parseDate(date)&&confirmedCount[d]>0&&(deadCount[d]>0||plotSpecificType==='fatality_line'||plotSpecificType==='fatality_line_only');}).filter(function(d){return parseDate(d)<=parseDate(plotDates[1])&&parseDate(d)>=parseDate(plotDates[0]);}).map(function(d){return{d:d,cfr:deadCount[d]!=null?deadCount[d]/confirmedCount[d]:0};}).map(function(_ref9){var d=_ref9.d,cfr=_ref9.cfr;return{x:confirmedCount[d],y:plotSpecificType==='fatality_line'||plotSpecificType==='fatality_line_only'?cfr:deadCount[d],date:d,lang:lang};})}];if(plotSpecificType==='fatality_line'||plotSpecificType==='fatality_line2')Object.keys(diseases).forEach(function(x){plotData.push({id:x,color:'var(--light-grey)',data:[{x:diseases[x].confirmedCount,y:plotSpecificType==='fatality_line'?diseases[x].deadCount/diseases[x].confirmedCount:diseases[x].deadCount,lang:lang,name:diseases[x][lang],years:diseases[x].years}]});});return{plotData:plotData};};var generatePlotDataSubregionFatality=function generatePlotDataSubregionFatality(_ref10){var data=_ref10.data,currentRegion=_ref10.currentRegion,date=_ref10.date,lang=_ref10.lang,darkMode=_ref10.darkMode,plotSpecificType=_ref10.plotSpecificType;var currentData=getCurrentData(data,currentRegion);var plotData=[];var maxValue=0;var minValue=100000;getSubregions(data,currentRegion).reverse().filter(function(region){return currentData[region]['confirmedCount'][date]>0&&currentData[region]['deadCount'][date]>=0&&(currentData[region]['deadCount'][date]>0||plotSpecificType==='subregion_fatality'||plotSpecificType==='subregion_fatality_only');}).forEach(function(region,i){var confirmedCount=currentData[region].confirmedCount[date];var deadCount=currentData[region].deadCount[date];maxValue=Math.max(maxValue,confirmedCount);minValue=Math.min(minValue,confirmedCount);plotData.push({id:region,color:darkMode?'rgba(222,73,104,0.6)':'rgba(183,55,121,0.5)',data:[{x:confirmedCount,y:plotSpecificType==='subregion_fatality'||plotSpecificType==='subregion_fatality_only'?deadCount/confirmedCount:deadCount,regionName:lang==='zh'?region:currentData[region].ENGLISH,lang:lang}]});});if(plotSpecificType==='subregion_fatality'||plotSpecificType==='subregion_fatality2')Object.keys(diseases).forEach(function(x){plotData.push({id:x,color:'rgba(0,0,0,0)',data:[{x:diseases[x].confirmedCount,y:plotSpecificType==='subregion_fatality'?diseases[x].deadCount/diseases[x].confirmedCount:diseases[x].deadCount,lang:lang,name:diseases[x][lang],years:diseases[x].years,noClick:true}]});});var _getLogTickValues=getLogTickValues(minValue,maxValue),logTickMin=_getLogTickValues.logTickMin,logTickMax=_getLogTickValues.logTickMax;return{plotData:plotData,logTickMin:logTickMin,logTickMax:logTickMax};};var generatePlotDataSubregion=function generatePlotDataSubregion(_ref11){var data=_ref11.data,date=_ref11.date,currentRegion=_ref11.currentRegion,lang=_ref11.lang,darkMode=_ref11.darkMode,playing=_ref11.playing,scale=_ref11.scale,metric=_ref11.metric,plotSpecificType=_ref11.plotSpecificType,plotDetails=_ref11.plotDetails,plotDates=_ref11.plotDates,fullPlot=_ref11.fullPlot;var currentData=getCurrentData(data,currentRegion);var maxValue=0;var minValue=100000;var numOfRegions=!fullPlot?6:10;var subregions=playing?getSubregions(data,currentRegion,metric,numOfRegions):getSubregions(data,currentRegion,metric,numOfRegions,date);var plotData=subregions.map(function(region,i){var counts=currentData[region][metric];var id=lang==='zh'?region:currentData[region].ENGLISH;return{id:simplifyName(id,lang),fullId:id,name:region,color:darkMode?\"var(--primary-color-\".concat(i<7?i:i+1,\")\"):\"var(--primary-color-\".concat(10-i,\")\"),data:Object.keys(counts).filter(function(d){return!playing||parseDate(d)<=parseDate(date);}).map(function(d){if(counts[d]>maxValue)maxValue=counts[d];if(counts[d]<minValue)minValue=counts[d];return scale==='linear'||counts[d]>0?{x:d,y:counts[d],lang:lang}:null;}).filter(function(x){return x!=null;})};}).reverse();if(plotSpecificType==='subregion_new')plotData=convertTotalToNew(plotData);plotData=calcMovingAverage(plotData,plotDetails.movingAverage);plotData=applyDateRange(plotData,plotDates);return _objectSpread({plotData:plotData},getTickValues(scale,plotSpecificType,fullPlot,minValue,maxValue));};var getCurrentData=function getCurrentData(data,currentRegion){var currentData=currentRegion.length===1&&currentRegion[0]===str.GLOBAL_ZH?data:getDataFromRegion(data,currentRegion);return currentData;};// convert cumulative dataset to daily increasement dataset\nvar convertTotalToNew=function convertTotalToNew(plotData){plotData.forEach(function(metricData){metricData.data=metricData.data.reduce(function(s,v,i){return[].concat(_toConsumableArray(s),[metricData.data[i-1]?_objectSpread({},v,{y:v.y-metricData.data[i-1].y}):v]);},[]);});return plotData;};// moving averages\nvar calcMovingAverage=function calcMovingAverage(plotData,days){if(days==='3d'){plotData.forEach(function(metricData){metricData.data=metricData.data.reduce(function(s,v,i){var newY=v.y;if(metricData.data[i-1]&&metricData.data[i+1]){newY=(metricData.data[i-1].y+v.y+metricData.data[i+1].y)/3;}return[].concat(_toConsumableArray(s),[_objectSpread({},v,{y:newY})]);},[]);});}else if(days==='5d'){plotData.forEach(function(metricData){metricData.data=metricData.data.reduce(function(s,v,i){var newY=v.y;if(metricData.data[i-1]&&metricData.data[i-2]&&metricData.data[i+1]&&metricData.data[i+2]){newY=(metricData.data[i-2].y+metricData.data[i-1].y+v.y+metricData.data[i+1].y+metricData.data[i+2].y)/5;}else if(metricData.data[i-1]&&metricData.data[i+1]){newY=(metricData.data[i-1].y+v.y+metricData.data[i+1].y)/3;}return[].concat(_toConsumableArray(s),[_objectSpread({},v,{y:newY})]);},[]);});}return plotData;};// apply date range\nvar applyDateRange=function applyDateRange(plotData,plotDates){plotData.forEach(function(p){p.data=p.data.filter(function(x){return parseDate(x.x)<=parseDate(plotDates[1])&&parseDate(x.x)>=parseDate(plotDates[0]);});});return plotData;};// data from top N subregions\nvar getSubregions=function getSubregions(data,currentRegion){var metric=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'confirmedCount';var topN=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var date=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var currentData=getCurrentData(data,currentRegion);var subregions=Object.keys(currentData).filter(function(region){return!['confirmedCount','deadCount','curedCount','ENGLISH',str.GLOBAL_ZH].includes(region);}).sort(function(a,b){var aCounts=Math.max.apply(Math,_toConsumableArray(Object.values(currentData[a][metric])));var bCounts=Math.max.apply(Math,_toConsumableArray(Object.values(currentData[b][metric])));if(date!=null){aCounts=currentData[a][metric][date]?currentData[a][metric][date]:0;bCounts=currentData[b][metric][date]?currentData[b][metric][date]:0;}return aCounts<=bCounts?1:-1;});// top affected subregions\nreturn topN!=null?subregions.filter(function(region,i){return i<=topN-1&&Math.max.apply(Math,_toConsumableArray(Object.values(currentData[region][metric])))!==0;}):subregions;};var getLogTickValues=function getLogTickValues(minValue,maxValue){var logTickMin=minValue<=maxValue?Math.max(Math.pow(10,Math.floor(Math.log10(minValue))),1):1;var logTickMax=minValue<=maxValue?Math.max(Math.pow(10,Math.ceil(Math.log10(maxValue))),10):1;var tickValues=_toConsumableArray(Array(Math.log10(logTickMax/logTickMin)+1).keys()).map(function(x){return Math.pow(10,x)*logTickMin;});return{tickValues:tickValues,logTickMin:logTickMin,logTickMax:logTickMax};};var getTickValues=function getTickValues(scale,plotSpecificType,fullPlot,minValue,maxValue){return scale==='log'&&plotSpecificTypes[plotSpecificType].log?getLogTickValues(minValue,maxValue):{tickValues:fullPlot?10:5,logTickMin:1,logTickMax:1};};var generatePlotDataFunc={total:generatePlotDataTotal,new:generatePlotDataNew,growth_total:generatePlotDataGrowthRate,growth_new:generatePlotDataGrowthRate,fatality_recovery:generatePlotDataRate,one_vs_rest:generatePlotDataOneVsRest,one_vs_rest_new:generatePlotDataOneVsRest,most_affected_subregions:generatePlotDataSubregionRankings,most_affected_subregions_new:generatePlotDataSubregionRankings,subregion_active_stream:generatePlotDataSubregionStream,fatality_line:generatePlotDataFatalityLine,fatality_line2:generatePlotDataFatalityLine,fatality_line_only:generatePlotDataFatalityLine,fatality_line2_only:generatePlotDataFatalityLine,subregion_fatality:generatePlotDataSubregionFatality,subregion_fatality2:generatePlotDataSubregionFatality,subregion_fatality_only:generatePlotDataSubregionFatality,subregion_fatality2_only:generatePlotDataSubregionFatality,subregion_total:generatePlotDataSubregion,subregion_new:generatePlotDataSubregion,subregion_total_stream:generatePlotDataSubregionStream,subregion_new_stream:generatePlotDataSubregionStream};","map":{"version":3,"sources":["D:/programming/react/new covid/covid19/src/utils/plot_data.js"],"names":["getDataFromRegion","metricText","parseDate","simplifyName","str","plotSpecificTypes","i18n","diseases","generatePlotData","params","generatePlotDataFunc","plotSpecificType","metricColors","confirmedCount","deadCount","curedCount","metricColorsDark","generatePlotDataTotal","data","date","currentRegion","lang","darkMode","playing","scale","plotDetails","plotDates","fullPlot","fullData","maxValue","minValue","plotData","map","metric","counts","id","color","Object","keys","sort","a","b","filter","d","x","y","calcMovingAverage","movingAverage","applyDateRange","getTickValues","generatePlotDataNew","convertTotalToNew","generatePlotDataGrowthRate","forEach","metricData","reduce","s","v","i","generatePlotDataRate","confirmedCounts","metrics","recoveryRate","newMetric","count","generatePlotDataOneVsRest","currentData","regionName","length","ENGLISH","parentRegion","GLOBAL_ZH","slice","parentData","parentCounts","parentRegionName","parentPlotData","REST","currentPlotData","push","generatePlotDataSubregionRankings","getCurrentData","subregions","getSubregions","regionIndices","dates","region","Set","dd","fullId","name","regionSkipped","regionCounts","generatePlotDataSubregionStream","sortBy","numOfRegions","subregionsData","plotKeys","OTHERS","reverse","subregionCounts","remainingConfirmed","Math","max","otherConfirmedCount","otherDeadCount","otherCuredCount","includes","confirmedCountPrevious","deadCountPrevious","curedCountPrevious","otherCount","generatePlotDataFatalityLine","cfr","years","generatePlotDataSubregionFatality","min","noClick","getLogTickValues","logTickMin","logTickMax","generatePlotDataSubregion","days","newY","p","topN","aCounts","values","bCounts","floor","log10","ceil","tickValues","Array","log","total","new","growth_total","growth_new","fatality_recovery","one_vs_rest","one_vs_rest_new","most_affected_subregions","most_affected_subregions_new","subregion_active_stream","fatality_line","fatality_line2","fatality_line_only","fatality_line2_only","subregion_fatality","subregion_fatality2","subregion_fatality_only","subregion_fatality2_only","subregion_total","subregion_new","subregion_total_stream","subregion_new_stream"],"mappings":"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","sourcesContent":["import { getDataFromRegion, metricText, parseDate, simplifyName } from './utils'\r\nimport * as str from './strings'\r\nimport { plotSpecificTypes } from './plot_types'\r\nimport i18n from '../data/i18n.yml'\r\nimport diseases from '../data/other_diseases_stats.yml'\r\n\r\nexport const generatePlotData = (params) => generatePlotDataFunc[params.plotSpecificType](params)\r\n\r\nconst metricColors = {\r\n    confirmedCount: 'var(--primary-color-4)',\r\n    deadCount: 'var(--primary-color-10)',\r\n    curedCount: 'var(--primary-color-2)'\r\n}\r\n\r\nconst metricColorsDark = {\r\n    confirmedCount: 'var(--primary-color-4)',\r\n    deadCount: 'var(--lighter-grey)',\r\n    curedCount: 'var(--primary-color-2)'\r\n}\r\n\r\nconst generatePlotDataTotal = (\r\n    { data, date, currentRegion, lang, darkMode, playing, scale, plotSpecificType, plotDetails, plotDates, fullPlot },\r\n    fullData = false\r\n) => {\r\n    let maxValue = 0\r\n    let minValue = 100000\r\n\r\n    let plotData = [ 'deadCount', 'curedCount', 'confirmedCount' ].map((metric) => {\r\n        const counts = getDataFromRegion(data, currentRegion)[metric]\r\n        return {\r\n            id: metricText[metric][lang],\r\n            color: darkMode ? metricColorsDark[metric] : metricColors[metric],\r\n            data: Object.keys(counts)\r\n                .sort((a, b) => (parseDate(a) > parseDate(b) ? 1 : -1))\r\n                .filter((d) => !playing || parseDate(d) <= parseDate(date))\r\n                .map((d) => {\r\n                    if (counts[d] > maxValue) maxValue = counts[d]\r\n                    if (counts[d] < minValue) minValue = counts[d]\r\n\r\n                    return scale === 'linear' || counts[d] > 0\r\n                        ? {\r\n                              x: d,\r\n                              y: counts[d]\r\n                          }\r\n                        : null\r\n                })\r\n                .filter((x) => x != null)\r\n        }\r\n    })\r\n\r\n    plotData = calcMovingAverage(plotData, plotDetails.movingAverage)\r\n    if (!fullData) plotData = applyDateRange(plotData, plotDates)\r\n\r\n    return { plotData, ...getTickValues(scale, plotSpecificType, fullPlot, minValue, maxValue) }\r\n}\r\n\r\nconst generatePlotDataNew = (params, fullData = false) => {\r\n    let { plotData } = generatePlotDataTotal(params, true)\r\n\r\n    plotData = convertTotalToNew(plotData)\r\n    if (!fullData) plotData = applyDateRange(plotData, params.plotDates)\r\n\r\n    return { plotData }\r\n}\r\n\r\nconst generatePlotDataGrowthRate = (params) => {\r\n    let { plotData } =\r\n        params.plotSpecificType === 'growth_total'\r\n            ? generatePlotDataTotal(params, true)\r\n            : generatePlotDataNew(params, true)\r\n    const metric = params.metric\r\n\r\n    plotData.forEach((metricData) => {\r\n        metricData.data = metricData.data.reduce(\r\n            (s, v, i) => [\r\n                ...s,\r\n                metricData.data[i - 1] && metricData.data[i - 1].y > 0\r\n                    ? { ...v, y: (v.y - metricData.data[i - 1].y) / metricData.data[i - 1].y }\r\n                    : { ...v, y: 0 }\r\n            ],\r\n            []\r\n        )\r\n    })\r\n\r\n    if (metric === 'confirmedCount') plotData = [ plotData[2] ]\r\n    if (metric === 'curedCount') plotData = [ plotData[1] ]\r\n    if (metric === 'deadCount') plotData = [ plotData[0] ]\r\n\r\n    plotData = applyDateRange(plotData, params.plotDates)\r\n\r\n    return { plotData }\r\n}\r\n\r\nconst generatePlotDataRate = ({ data, currentRegion, darkMode, lang, date, playing, plotDetails, plotDates }) => {\r\n    const confirmedCounts = getDataFromRegion(data, currentRegion)['confirmedCount']\r\n\r\n    const metrics = plotDetails.recoveryRate === 'show' ? [ 'deadCount', 'curedCount' ] : [ 'deadCount' ]\r\n    let plotData = metrics.map((metric) => {\r\n        const counts = getDataFromRegion(data, currentRegion)[metric]\r\n        const newMetric = metric === 'deadCount' ? 'fatalityRate' : 'recoveryRate'\r\n        return {\r\n            id: metricText[newMetric][lang],\r\n            color: darkMode ? metricColorsDark[metric] : metricColors[metric],\r\n            data: Object.keys(counts)\r\n                .filter((d) => !playing || parseDate(d) <= parseDate(date))\r\n                .map((d) => ({ d, count: confirmedCounts[d] > 0 ? counts[d] / confirmedCounts[d] : 0 }))\r\n                .map(({ d, count }) => {\r\n                    return {\r\n                        x: d,\r\n                        y: count\r\n                    }\r\n                })\r\n        }\r\n    })\r\n\r\n    plotData = calcMovingAverage(plotData, plotDetails.movingAverage)\r\n    plotData = applyDateRange(plotData, plotDates)\r\n\r\n    return { plotData }\r\n}\r\n\r\nconst generatePlotDataOneVsRest = ({\r\n    data,\r\n    currentRegion,\r\n    metric,\r\n    lang,\r\n    date,\r\n    playing,\r\n    scale,\r\n    plotSpecificType,\r\n    plotDetails,\r\n    plotDates,\r\n    fullPlot\r\n}) => {\r\n    let maxValue = 0\r\n    let minValue = 100000\r\n\r\n    const currentData = getDataFromRegion(data, currentRegion)\r\n    const counts = currentData[metric]\r\n    let regionName = lang === 'zh' ? currentRegion[currentRegion.length - 1] : currentData.ENGLISH\r\n    regionName = simplifyName(regionName, lang)\r\n\r\n    const parentRegion =\r\n        currentRegion.length === 1 ? [ str.GLOBAL_ZH ] : currentRegion.slice(0, currentRegion.length - 1)\r\n    const parentData = getDataFromRegion(data, parentRegion)\r\n    const parentCounts = parentData[metric]\r\n    let parentRegionName = lang === 'zh' ? parentRegion[parentRegion.length - 1] : parentData.ENGLISH\r\n    parentRegionName = simplifyName(parentRegionName, lang)\r\n\r\n    let plotData = []\r\n\r\n    const parentPlotData = {\r\n        id: lang === 'zh' ? `${parentRegionName} (${i18n.REST[lang]})` : `${i18n.REST[lang]} of ${parentRegionName}`,\r\n        color: 'var(--primary-color-4)',\r\n        data: Object.keys(parentCounts)\r\n            .filter((d) => !playing || parseDate(d) <= parseDate(date))\r\n            .map((d) => {\r\n                if (counts[d] == null) return null\r\n\r\n                if (parentCounts[d] - counts[d] > maxValue) maxValue = parentCounts[d] - counts[d]\r\n                if (parentCounts[d] - counts[d] < minValue) minValue = parentCounts[d] - counts[d]\r\n\r\n                return scale === 'linear' || parentCounts[d] - counts[d] > 0\r\n                    ? {\r\n                          x: d,\r\n                          y: parentCounts[d] - counts[d]\r\n                      }\r\n                    : null\r\n            })\r\n            .filter((x) => x != null)\r\n    }\r\n\r\n    const currentPlotData = {\r\n        id: regionName,\r\n        color: 'var(--primary-color-2)',\r\n        data: Object.keys(counts)\r\n            .filter((d) => !playing || parseDate(d) <= parseDate(date))\r\n            .map((d) => {\r\n                if (parentCounts[d] == null) return null\r\n\r\n                if (counts[d] > maxValue) maxValue = counts[d]\r\n                if (counts[d] < minValue) minValue = counts[d]\r\n\r\n                return scale === 'linear' || counts[d] > 0\r\n                    ? {\r\n                          x: d,\r\n                          y: counts[d]\r\n                      }\r\n                    : null\r\n            })\r\n            .filter((x) => x != null)\r\n    }\r\n\r\n    plotData.push(parentPlotData)\r\n    plotData.push(currentPlotData)\r\n    if (plotSpecificType === 'one_vs_rest_new') {\r\n        plotData = convertTotalToNew(plotData)\r\n    }\r\n\r\n    plotData = calcMovingAverage(plotData, plotDetails.movingAverage)\r\n    plotData = applyDateRange(plotData, plotDates)\r\n\r\n    return { plotData, ...getTickValues(scale, plotSpecificType, fullPlot, minValue, maxValue) }\r\n}\r\n\r\nconst generatePlotDataSubregionRankings = ({\r\n    data,\r\n    currentRegion,\r\n    metric,\r\n    lang,\r\n    darkMode,\r\n    playing,\r\n    date,\r\n    plotDates,\r\n    plotSpecificType\r\n}) => {\r\n    const currentData = getCurrentData(data, currentRegion)\r\n    const subregions = playing\r\n        ? getSubregions(data, currentRegion, metric, 10)\r\n        : getSubregions(data, currentRegion, metric, 10, date)\r\n\r\n    let regionIndices = {}\r\n    let dates = []\r\n\r\n    let plotData = subregions\r\n        .map((region, i) => {\r\n            dates = [ ...dates, ...Object.keys(currentData[region][metric]) ]\r\n            dates = [ ...new Set(dates) ]\r\n            regionIndices[region] = i\r\n            return region\r\n        })\r\n        .map((region, i) => {\r\n            const id = lang === 'zh' ? region : currentData[region].ENGLISH\r\n            const dd = Object.keys(currentData[region][metric])\r\n                .sort((a, b) => (parseDate(a) > parseDate(b) ? 1 : -1))\r\n                .filter((d) => parseDate(d) <= parseDate(date))\r\n                .filter((d) => parseDate(d) <= parseDate(plotDates[1]) && parseDate(d) >= parseDate(plotDates[0]))\r\n            const counts = dd.map((d) => currentData[region][metric][d])\r\n            let count = counts[counts.length - 1]\r\n            if (plotSpecificType === 'most_affected_subregions_new')\r\n                count =\r\n                    counts.length >= 2\r\n                        ? counts[counts.length - 1] - counts[counts.length - 2]\r\n                        : counts[counts.length - 1]\r\n            return {\r\n                id: simplifyName(id, lang),\r\n                fullId: id,\r\n                name: region,\r\n                color: darkMode ? `var(--primary-color-${i < 7 ? i : i + 1})` : `var(--primary-color-${10 - i})`,\r\n                count,\r\n                data: []\r\n            }\r\n        })\r\n\r\n    dates = dates.sort((a, b) => (parseDate(a) > parseDate(b) ? 1 : -1))\r\n\r\n    let regionSkipped = {}\r\n    dates\r\n        .filter((d) => parseDate(d) <= parseDate(date))\r\n        .filter((d) => parseDate(d) <= parseDate(plotDates[1]) && parseDate(d) >= parseDate(plotDates[0]))\r\n        .forEach((d, i) => {\r\n            let regionCounts = []\r\n            plotData.forEach((region) => {\r\n                let counts = currentData[region.name][metric][d] ? currentData[region.name][metric][d] : 0\r\n                if (plotSpecificType === 'most_affected_subregions_new') {\r\n                    if (i > 0 && currentData[region.name][metric][dates[i - 1]])\r\n                        counts = counts - currentData[region.name][metric][dates[i - 1]]\r\n                }\r\n                regionCounts.push({\r\n                    region: region.name,\r\n                    counts\r\n                })\r\n            })\r\n            regionCounts = regionCounts.sort((a, b) => (a.counts <= b.counts ? 1 : -1))\r\n\r\n            regionCounts.forEach((region, i) => {\r\n                if (region.counts === 0 && regionSkipped[region.region] == null) {\r\n                    plotData[regionIndices[region.region]].data.push({\r\n                        x: d,\r\n                        y: null\r\n                    })\r\n                } else {\r\n                    regionSkipped[region.region] = true\r\n                    plotData[regionIndices[region.region]].data.push({\r\n                        x: d,\r\n                        y: i + 1\r\n                    })\r\n                }\r\n            })\r\n        })\r\n\r\n    return { plotData, dates }\r\n}\r\n\r\nconst generatePlotDataSubregionStream = ({\r\n    data,\r\n    currentRegion,\r\n    lang,\r\n    playing,\r\n    date,\r\n    plotDates,\r\n    metric,\r\n    plotSpecificType,\r\n    fullPlot\r\n}) => {\r\n    const currentData = getCurrentData(data, currentRegion)\r\n    let dates = []\r\n    let plotData = []\r\n\r\n    const sortBy = plotSpecificType === 'subregion_active_stream' ? 'confirmedCount' : metric\r\n    const numOfRegions = !fullPlot ? 5 : 9\r\n    let subregionsData = getSubregions(data, currentRegion, sortBy, numOfRegions)\r\n        .map((region) => {\r\n            dates = [ ...dates, ...Object.keys(currentData[region]['confirmedCount']) ]\r\n            dates = [ ...new Set(dates) ]\r\n            return region\r\n        })\r\n        .map((region) => {\r\n            const id = lang === 'zh' ? region : currentData[region].ENGLISH\r\n            return {\r\n                id: simplifyName(id, lang),\r\n                fullId: id,\r\n                name: region\r\n            }\r\n        })\r\n\r\n    let plotKeys = subregionsData.map((x) => x.id)\r\n\r\n    // at least (numOfRegions + 1) subregions\r\n    if (Object.keys(currentData).length >= numOfRegions + 5) plotKeys = [ ...plotKeys, i18n.OTHERS[lang] ]\r\n    plotKeys = plotKeys.reverse()\r\n\r\n    dates = dates.sort((a, b) => (parseDate(a) > parseDate(b) ? 1 : -1))\r\n    dates = dates.filter((d) => parseDate(d) <= parseDate(plotDates[1]) && parseDate(d) >= parseDate(plotDates[0]))\r\n\r\n    // no subregions\r\n    if (subregionsData.length === 0) {\r\n        dates = Object.keys(currentData['confirmedCount']).sort((a, b) => (parseDate(a) > parseDate(b) ? 1 : -1))\r\n        let id = lang === 'zh' ? currentRegion[currentRegion.length - 1] : currentData.ENGLISH\r\n        id = simplifyName(id, lang)\r\n        plotKeys = [ id ]\r\n    }\r\n\r\n    dates.filter((d) => !playing || parseDate(d) <= parseDate(date)).forEach((d, i) => {\r\n        let subregionCounts = {}\r\n        subregionsData.forEach((region) => {\r\n            if (plotSpecificType === 'subregion_active_stream') {\r\n                const confirmedCount = currentData[region.name]['confirmedCount'][d]\r\n                    ? currentData[region.name]['confirmedCount'][d]\r\n                    : 0\r\n                const deadCount = currentData[region.name]['deadCount'][d]\r\n                    ? currentData[region.name]['deadCount'][d]\r\n                    : 0\r\n                const curedCount = currentData[region.name]['curedCount'][d]\r\n                    ? currentData[region.name]['curedCount'][d]\r\n                    : 0\r\n                const remainingConfirmed = Math.max(confirmedCount - deadCount - curedCount, 0)\r\n                subregionCounts[region.id] = remainingConfirmed\r\n            } else {\r\n                let count = currentData[region.name][metric][d] ? currentData[region.name][metric][d] : 0\r\n                if (plotSpecificType === 'subregion_new_stream' && currentData[region.name][metric][dates[i - 1]])\r\n                    count -= currentData[region.name][metric][dates[i - 1]]\r\n                subregionCounts[region.id] = count\r\n            }\r\n        })\r\n\r\n        let otherConfirmedCount = 0\r\n        let otherDeadCount = 0\r\n        let otherCuredCount = 0\r\n\r\n        // compute number of remaining confirmed cases from non-top-5 subregions\r\n        Object.keys(currentData)\r\n            .filter(\r\n                (region) => ![ 'confirmedCount', 'deadCount', 'curedCount', 'ENGLISH', str.GLOBAL_ZH ].includes(region)\r\n            )\r\n            .filter((region) => !subregionsData.map((x) => x.name).includes(region))\r\n            .forEach((region) => {\r\n                const confirmedCount = currentData[region]['confirmedCount'][d]\r\n                    ? currentData[region]['confirmedCount'][d]\r\n                    : 0\r\n                const deadCount = currentData[region]['deadCount'][d] ? currentData[region]['deadCount'][d] : 0\r\n                const curedCount = currentData[region]['curedCount'][d] ? currentData[region]['curedCount'][d] : 0\r\n                otherConfirmedCount += confirmedCount\r\n                otherDeadCount += deadCount\r\n                otherCuredCount += curedCount\r\n                if (plotSpecificType === 'subregion_new_stream') {\r\n                    const confirmedCountPrevious = currentData[region]['confirmedCount'][dates[i - 1]]\r\n                        ? currentData[region]['confirmedCount'][dates[i - 1]]\r\n                        : 0\r\n                    const deadCountPrevious = currentData[region]['deadCount'][dates[i - 1]]\r\n                        ? currentData[region]['deadCount'][dates[i - 1]]\r\n                        : 0\r\n                    const curedCountPrevious = currentData[region]['curedCount'][dates[i - 1]]\r\n                        ? currentData[region]['curedCount'][dates[i - 1]]\r\n                        : 0\r\n                    otherConfirmedCount -= confirmedCountPrevious\r\n                    otherDeadCount -= deadCountPrevious\r\n                    otherCuredCount -= curedCountPrevious\r\n                }\r\n            })\r\n        let otherCount = 0\r\n        if (metric === 'confirmedCount') otherCount = Math.max(otherConfirmedCount, 0)\r\n        if (metric === 'deadCount') otherCount = Math.max(otherDeadCount, 0)\r\n        if (metric === 'curedCount') otherCount = Math.max(otherCuredCount, 0)\r\n        if (plotSpecificType === 'subregion_active_stream')\r\n            otherCount = Math.max(otherConfirmedCount - otherDeadCount - otherCuredCount, 0)\r\n\r\n        if (Object.keys(currentData).length >= 10) subregionCounts[i18n.OTHERS[lang]] = otherCount\r\n\r\n        // no subregions\r\n        if (subregionsData.length === 0) {\r\n            const confirmedCount = currentData['confirmedCount'][d] ? currentData['confirmedCount'][d] : 0\r\n            const deadCount = currentData['deadCount'][d] ? currentData['deadCount'][d] : 0\r\n            const curedCount = currentData['curedCount'][d] ? currentData['curedCount'][d] : 0\r\n            const remainingConfirmed = Math.max(confirmedCount - deadCount - curedCount, 0)\r\n            let id = lang === 'zh' ? currentRegion[currentRegion.length - 1] : currentData.ENGLISH\r\n            id = simplifyName(id, lang)\r\n            subregionCounts[id] =\r\n                plotSpecificType === 'subregion_active_stream'\r\n                    ? remainingConfirmed\r\n                    : Math.max(currentData[metric][d] ? currentData[metric][d] : 0, 0)\r\n        }\r\n        plotData.push(subregionCounts)\r\n    })\r\n    return { plotData, dates, plotKeys }\r\n}\r\n\r\nconst generatePlotDataFatalityLine = ({ data, currentRegion, date, darkMode, lang, plotSpecificType, plotDates }) => {\r\n    const confirmedCount = getDataFromRegion(data, currentRegion)['confirmedCount']\r\n    const deadCount = getDataFromRegion(data, currentRegion)['deadCount']\r\n    const plotData = [\r\n        {\r\n            id: 'fatality-line',\r\n            color: darkMode ? 'var(--primary-color-2)' : 'var(--primary-color-5)',\r\n            data: Object.keys(confirmedCount)\r\n                .filter(\r\n                    (d) =>\r\n                        parseDate(d) <= parseDate(date) &&\r\n                        confirmedCount[d] > 0 &&\r\n                        (deadCount[d] > 0 ||\r\n                            plotSpecificType === 'fatality_line' ||\r\n                            plotSpecificType === 'fatality_line_only')\r\n                )\r\n                .filter((d) => parseDate(d) <= parseDate(plotDates[1]) && parseDate(d) >= parseDate(plotDates[0]))\r\n                .map((d) => ({ d, cfr: deadCount[d] != null ? deadCount[d] / confirmedCount[d] : 0 }))\r\n                .map(({ d, cfr }) => {\r\n                    return {\r\n                        x: confirmedCount[d],\r\n                        y:\r\n                            plotSpecificType === 'fatality_line' || plotSpecificType === 'fatality_line_only'\r\n                                ? cfr\r\n                                : deadCount[d],\r\n                        date: d,\r\n                        lang\r\n                    }\r\n                })\r\n        }\r\n    ]\r\n    if (plotSpecificType === 'fatality_line' || plotSpecificType === 'fatality_line2')\r\n        Object.keys(diseases).forEach((x) => {\r\n            plotData.push({\r\n                id: x,\r\n                color: 'var(--light-grey)',\r\n                data: [\r\n                    {\r\n                        x: diseases[x].confirmedCount,\r\n                        y:\r\n                            plotSpecificType === 'fatality_line'\r\n                                ? diseases[x].deadCount / diseases[x].confirmedCount\r\n                                : diseases[x].deadCount,\r\n                        lang,\r\n                        name: diseases[x][lang],\r\n                        years: diseases[x].years\r\n                    }\r\n                ]\r\n            })\r\n        })\r\n    return { plotData }\r\n}\r\n\r\nconst generatePlotDataSubregionFatality = ({ data, currentRegion, date, lang, darkMode, plotSpecificType }) => {\r\n    const currentData = getCurrentData(data, currentRegion)\r\n    let plotData = []\r\n    let maxValue = 0\r\n    let minValue = 100000\r\n\r\n    getSubregions(data, currentRegion)\r\n        .reverse()\r\n        .filter(\r\n            (region) =>\r\n                currentData[region]['confirmedCount'][date] > 0 &&\r\n                currentData[region]['deadCount'][date] >= 0 &&\r\n                (currentData[region]['deadCount'][date] > 0 ||\r\n                    plotSpecificType === 'subregion_fatality' ||\r\n                    plotSpecificType === 'subregion_fatality_only')\r\n        )\r\n        .forEach((region, i) => {\r\n            const confirmedCount = currentData[region].confirmedCount[date]\r\n            const deadCount = currentData[region].deadCount[date]\r\n            maxValue = Math.max(maxValue, confirmedCount)\r\n            minValue = Math.min(minValue, confirmedCount)\r\n\r\n            plotData.push({\r\n                id: region,\r\n                color: darkMode ? 'rgba(222,73,104,0.6)' : 'rgba(183,55,121,0.5)',\r\n                data: [\r\n                    {\r\n                        x: confirmedCount,\r\n                        y:\r\n                            plotSpecificType === 'subregion_fatality' || plotSpecificType === 'subregion_fatality_only'\r\n                                ? deadCount / confirmedCount\r\n                                : deadCount,\r\n                        regionName: lang === 'zh' ? region : currentData[region].ENGLISH,\r\n                        lang\r\n                    }\r\n                ]\r\n            })\r\n        })\r\n\r\n    if (plotSpecificType === 'subregion_fatality' || plotSpecificType === 'subregion_fatality2')\r\n        Object.keys(diseases).forEach((x) => {\r\n            plotData.push({\r\n                id: x,\r\n                color: 'rgba(0,0,0,0)',\r\n                data: [\r\n                    {\r\n                        x: diseases[x].confirmedCount,\r\n                        y:\r\n                            plotSpecificType === 'subregion_fatality'\r\n                                ? diseases[x].deadCount / diseases[x].confirmedCount\r\n                                : diseases[x].deadCount,\r\n                        lang,\r\n                        name: diseases[x][lang],\r\n                        years: diseases[x].years,\r\n                        noClick: true\r\n                    }\r\n                ]\r\n            })\r\n        })\r\n\r\n    const { logTickMin, logTickMax } = getLogTickValues(minValue, maxValue)\r\n\r\n    return { plotData, logTickMin, logTickMax }\r\n}\r\n\r\nconst generatePlotDataSubregion = ({\r\n    data,\r\n    date,\r\n    currentRegion,\r\n    lang,\r\n    darkMode,\r\n    playing,\r\n    scale,\r\n    metric,\r\n    plotSpecificType,\r\n    plotDetails,\r\n    plotDates,\r\n    fullPlot\r\n}) => {\r\n    const currentData = getCurrentData(data, currentRegion)\r\n    let maxValue = 0\r\n    let minValue = 100000\r\n\r\n    const numOfRegions = !fullPlot ? 6 : 10\r\n    const subregions = playing\r\n        ? getSubregions(data, currentRegion, metric, numOfRegions)\r\n        : getSubregions(data, currentRegion, metric, numOfRegions, date)\r\n\r\n    let plotData = subregions\r\n        .map((region, i) => {\r\n            const counts = currentData[region][metric]\r\n            const id = lang === 'zh' ? region : currentData[region].ENGLISH\r\n            return {\r\n                id: simplifyName(id, lang),\r\n                fullId: id,\r\n                name: region,\r\n                color: darkMode ? `var(--primary-color-${i < 7 ? i : i + 1})` : `var(--primary-color-${10 - i})`,\r\n                data: Object.keys(counts)\r\n                    .filter((d) => !playing || parseDate(d) <= parseDate(date))\r\n                    .map((d) => {\r\n                        if (counts[d] > maxValue) maxValue = counts[d]\r\n                        if (counts[d] < minValue) minValue = counts[d]\r\n\r\n                        return scale === 'linear' || counts[d] > 0\r\n                            ? {\r\n                                  x: d,\r\n                                  y: counts[d],\r\n                                  lang\r\n                              }\r\n                            : null\r\n                    })\r\n                    .filter((x) => x != null)\r\n            }\r\n        })\r\n        .reverse()\r\n\r\n    if (plotSpecificType === 'subregion_new') plotData = convertTotalToNew(plotData)\r\n\r\n    plotData = calcMovingAverage(plotData, plotDetails.movingAverage)\r\n    plotData = applyDateRange(plotData, plotDates)\r\n\r\n    return { plotData, ...getTickValues(scale, plotSpecificType, fullPlot, minValue, maxValue) }\r\n}\r\n\r\nconst getCurrentData = (data, currentRegion) => {\r\n    const currentData =\r\n        currentRegion.length === 1 && currentRegion[0] === str.GLOBAL_ZH ? data : getDataFromRegion(data, currentRegion)\r\n\r\n    return currentData\r\n}\r\n\r\n// convert cumulative dataset to daily increasement dataset\r\nconst convertTotalToNew = (plotData) => {\r\n    plotData.forEach((metricData) => {\r\n        metricData.data = metricData.data.reduce(\r\n            (s, v, i) => [ ...s, metricData.data[i - 1] ? { ...v, y: v.y - metricData.data[i - 1].y } : v ],\r\n            []\r\n        )\r\n    })\r\n\r\n    return plotData\r\n}\r\n\r\n// moving averages\r\nconst calcMovingAverage = (plotData, days) => {\r\n    if (days === '3d') {\r\n        plotData.forEach((metricData) => {\r\n            metricData.data = metricData.data.reduce((s, v, i) => {\r\n                let newY = v.y\r\n                if (metricData.data[i - 1] && metricData.data[i + 1]) {\r\n                    newY = (metricData.data[i - 1].y + v.y + metricData.data[i + 1].y) / 3\r\n                }\r\n                return [ ...s, { ...v, y: newY } ]\r\n            }, [])\r\n        })\r\n    } else if (days === '5d') {\r\n        plotData.forEach((metricData) => {\r\n            metricData.data = metricData.data.reduce((s, v, i) => {\r\n                let newY = v.y\r\n                if (\r\n                    metricData.data[i - 1] &&\r\n                    metricData.data[i - 2] &&\r\n                    metricData.data[i + 1] &&\r\n                    metricData.data[i + 2]\r\n                ) {\r\n                    newY =\r\n                        (metricData.data[i - 2].y +\r\n                            metricData.data[i - 1].y +\r\n                            v.y +\r\n                            metricData.data[i + 1].y +\r\n                            metricData.data[i + 2].y) /\r\n                        5\r\n                } else if (metricData.data[i - 1] && metricData.data[i + 1]) {\r\n                    newY = (metricData.data[i - 1].y + v.y + metricData.data[i + 1].y) / 3\r\n                }\r\n                return [ ...s, { ...v, y: newY } ]\r\n            }, [])\r\n        })\r\n    }\r\n\r\n    return plotData\r\n}\r\n\r\n// apply date range\r\nconst applyDateRange = (plotData, plotDates) => {\r\n    plotData.forEach((p) => {\r\n        p.data = p.data.filter(\r\n            (x) => parseDate(x.x) <= parseDate(plotDates[1]) && parseDate(x.x) >= parseDate(plotDates[0])\r\n        )\r\n    })\r\n\r\n    return plotData\r\n}\r\n\r\n// data from top N subregions\r\nconst getSubregions = (data, currentRegion, metric = 'confirmedCount', topN = null, date = null) => {\r\n    const currentData = getCurrentData(data, currentRegion)\r\n\r\n    const subregions = Object.keys(currentData)\r\n        .filter((region) => ![ 'confirmedCount', 'deadCount', 'curedCount', 'ENGLISH', str.GLOBAL_ZH ].includes(region))\r\n        .sort((a, b) => {\r\n            let aCounts = Math.max(...Object.values(currentData[a][metric]))\r\n            let bCounts = Math.max(...Object.values(currentData[b][metric]))\r\n            if (date != null) {\r\n                aCounts = currentData[a][metric][date] ? currentData[a][metric][date] : 0\r\n                bCounts = currentData[b][metric][date] ? currentData[b][metric][date] : 0\r\n            }\r\n\r\n            return aCounts <= bCounts ? 1 : -1\r\n        })\r\n\r\n    // top affected subregions\r\n    return topN != null\r\n        ? subregions.filter(\r\n              (region, i) => i <= topN - 1 && Math.max(...Object.values(currentData[region][metric])) !== 0\r\n          )\r\n        : subregions\r\n}\r\n\r\nconst getLogTickValues = (minValue, maxValue) => {\r\n    const logTickMin = minValue <= maxValue ? Math.max(10 ** Math.floor(Math.log10(minValue)), 1) : 1\r\n    const logTickMax = minValue <= maxValue ? Math.max(10 ** Math.ceil(Math.log10(maxValue)), 10) : 1\r\n    const tickValues = [ ...Array(Math.log10(logTickMax / logTickMin) + 1).keys() ].map((x) => 10 ** x * logTickMin)\r\n\r\n    return { tickValues, logTickMin, logTickMax }\r\n}\r\n\r\nconst getTickValues = (scale, plotSpecificType, fullPlot, minValue, maxValue) => {\r\n    return scale === 'log' && plotSpecificTypes[plotSpecificType].log\r\n        ? getLogTickValues(minValue, maxValue)\r\n        : { tickValues: fullPlot ? 10 : 5, logTickMin: 1, logTickMax: 1 }\r\n}\r\n\r\nconst generatePlotDataFunc = {\r\n    total: generatePlotDataTotal,\r\n    new: generatePlotDataNew,\r\n    growth_total: generatePlotDataGrowthRate,\r\n    growth_new: generatePlotDataGrowthRate,\r\n    fatality_recovery: generatePlotDataRate,\r\n    one_vs_rest: generatePlotDataOneVsRest,\r\n    one_vs_rest_new: generatePlotDataOneVsRest,\r\n    most_affected_subregions: generatePlotDataSubregionRankings,\r\n    most_affected_subregions_new: generatePlotDataSubregionRankings,\r\n    subregion_active_stream: generatePlotDataSubregionStream,\r\n    fatality_line: generatePlotDataFatalityLine,\r\n    fatality_line2: generatePlotDataFatalityLine,\r\n    fatality_line_only: generatePlotDataFatalityLine,\r\n    fatality_line2_only: generatePlotDataFatalityLine,\r\n    subregion_fatality: generatePlotDataSubregionFatality,\r\n    subregion_fatality2: generatePlotDataSubregionFatality,\r\n    subregion_fatality_only: generatePlotDataSubregionFatality,\r\n    subregion_fatality2_only: generatePlotDataSubregionFatality,\r\n    subregion_total: generatePlotDataSubregion,\r\n    subregion_new: generatePlotDataSubregion,\r\n    subregion_total_stream: generatePlotDataSubregionStream,\r\n    subregion_new_stream: generatePlotDataSubregionStream\r\n}\r\n"]},"metadata":{},"sourceType":"module"}