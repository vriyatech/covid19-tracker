!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).ReactCompoundSlider={},e.React)}(this,function(e,t){"use strict";var n="default"in t?t.default:t;var o,s=(function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},t.apply(this,arguments)}e.exports=t}(o={exports:{}},o.exports),o.exports);var a=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},r=function(){};const i=(...e)=>(...t)=>e.forEach(e=>e&&e(...t));class l extends t.Component{constructor(...e){super(...e),a(this,"getRailProps",(e={})=>{const{emitMouse:t,emitTouch:n}=this.props;return{...e,onMouseDown:i(e.onMouseDown,t),onTouchStart:i(e.onTouchStart,n)}})}render(){const{getRailProps:e,props:{getEventData:t,activeHandleID:o,children:s}}=this,a=s({getEventData:t,activeHandleID:o,getRailProps:e});return a&&n.Children.only(a)}}class u extends t.Component{render(){const{children:e,values:t,scale:o,count:s,getEventData:a,activeHandleID:r}=this.props,i=e({getEventData:a,activeHandleID:r,ticks:(t||o.getTicks(s)).map(e=>({id:`$$-${e}`,value:e,percent:o.getValue(e)}))});return i&&n.Children.only(i)}}u.defaultProps={count:10};class c extends t.Component{constructor(...e){super(...e),a(this,"getTrackProps",(e={})=>{const{emitMouse:t,emitTouch:n}=this.props;return{...e,onMouseDown:i(e.onMouseDown,t),onTouchStart:i(e.onTouchStart,n)}})}render(){const{getTrackProps:e,props:{children:t,left:o,right:s,scale:a,handles:r,getEventData:i,activeHandleID:l}}=this,u=a.getDomain(),c=[];for(let e=0;e<r.length+1;e++){let t=r[e-1],n=r[e];0===e&&!0===o?t={id:"$",value:u[0],percent:0}:e===r.length&&!0===s&&(n={id:"$",value:u[1],percent:100}),t&&n&&c.push({id:`${t.id}-${n.id}`,source:t,target:n})}const h=t({getEventData:i,activeHandleID:l,tracks:c,getTrackProps:e});return h&&n.Children.only(h)}}c.defaultProps={left:!0,right:!0};class h extends t.Component{constructor(...e){super(...e),a(this,"autofocus",e=>{e.target.focus()}),a(this,"getHandleProps",(e,t={})=>{const{emitKeyboard:n,emitMouse:o,emitTouch:s}=this.props;return{...t,onKeyDown:i(t.onKeyDown,t=>n(t,e)),onMouseDown:i(t.onMouseDown,this.autofocus,t=>o(t,e)),onTouchStart:i(t.onTouchStart,t=>s(t,e))}})}render(){const{getHandleProps:e,props:{activeHandleID:t,children:o,handles:s}}=this,a=o({handles:s,activeHandleID:t,getHandleProps:e});return a&&n.Children.only(a)}}const d="react-compound-slider:";function p(e){return function(t,n){return t.val>n.val?e?-1:1:n.val>t.val?e?1:-1:0}}function v(e,t,n,o){const s=e.findIndex(e=>e.key===t);if(-1!==s){const{key:t,val:a}=e[s];return a===n?e:[...e.slice(0,s),{key:t,val:n},...e.slice(s+1)].sort(p(o))}return e}function m(e,t){if(!e)return[0,0];const n=e.getBoundingClientRect();return[t?n.top:n.left,t?n.bottom:n.right]}function f({type:e="",touches:t}){return!t||t.length>1||"touchend"===e.toLowerCase()&&t.length>0}function g(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function D(e=[],t,n,o){let s=0;return{handles:e.map(e=>{const t=n.getValue(e);return e!==t&&(s+=1,r(!o,`${d} Invalid value encountered. Changing ${e} to ${t}.`)),t}).map((e,t)=>({key:`$$-${t}`,val:e})).sort(p(t)),changes:s}}function M(e,t){return t}function y(e,t){for(let n=0;n<e.length;n++){if(e[n].key!==t[n].key)return e;if(t[n+1]&&t[n].val===t[n+1].val)return e}return t}function T(e,t,n,o,s){let a=-1,r=!0;for(let n=0;n<e.length;n++){const o=e[n],s=t[n];if(!s||s.key!==o.key)return e;s.val!==o.val&&(a=n,r=s.val-o.val>0)}if(-1===a)return e;{const i=r?n:-n;for(let r=0;r<t.length;r++){const l=t[r],u=t[r+1];if(u&&l.val===u.val){if(r===a){const a=u.val+i;if(s(a)===a){const a=T(t,v(t,u.key,u.val+i,o),n,o,s);return a===t?e:a}return e}{const a=l.val+i;if(s(a)===a){const a=T(t,v(t,l.key,l.val+i,o),n,o,s);return a===t?e:a}return e}}}}return t}function S(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}!function(e){var t;1===e.length&&(t=e,e=function(e,n){return S(t(e),n)})}(S);var E=Math.sqrt(50),k=Math.sqrt(10),w=Math.sqrt(2);function x(e,t,n){var o,s,a,r,i=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((o=t<e)&&(s=e,e=t,t=s),0===(r=function(e,t,n){var o=(t-e)/Math.max(0,n),s=Math.floor(Math.log(o)/Math.LN10),a=o/Math.pow(10,s);return s>=0?(a>=E?10:a>=k?5:a>=w?2:1)*Math.pow(10,s):-Math.pow(10,-s)/(a>=E?10:a>=k?5:a>=w?2:1)}(e,t,n))||!isFinite(r))return[];if(r>0)for(e=Math.ceil(e/r),t=Math.floor(t/r),a=new Array(s=Math.ceil(t-e+1));++i<s;)a[i]=(e+i)*r;else for(e=Math.floor(e*r),t=Math.ceil(t*r),a=new Array(s=Math.ceil(e-t+1));++i<s;)a[i]=(e-i)/r;return o&&a.reverse(),a}class H{constructor(){this.domain=[0,1],this.range=[0,1],this.interpolator=null}createInterpolator(e,t){let n=e[0];const o=e[1];let s=t[0];const a=t[1];return o<n?(n=this.deinterpolateValue(o,n),s=this.interpolateValue(a,s)):(n=this.deinterpolateValue(n,o),s=this.interpolateValue(s,a)),e=>s(n(e))}interpolateValue(e,t){return t-=e=+e,function(n){return e+t*n}}deinterpolateValue(e,t){return(t-=e=+e)?n=>(n-e)/t:()=>t}rescale(){return this.interpolator=null,this}getValue(e){const{domain:t,range:n}=this;return(this.interpolator||(this.interpolator=this.createInterpolator(t,n)))(+e)}setDomain(e){return this.domain=e.map(e=>+e),this.rescale(),this}getDomain(){return this.domain}setRange(e){return this.range=e.map(e=>+e),this}getTicks(e){const t=this.domain;return x(t[0],t[t.length-1],e||10)}}function I(e,t,n){return Math.min(Math.max(e,t),n)}class P{constructor(){a(this,"setDomain",e=>(this.domain=e.slice(),this)),a(this,"setRange",e=>(this.range=e.slice(),this)),a(this,"setStep",e=>(this.step=e,this)),a(this,"getValue",e=>{const{domain:[t,n],range:[o,s],step:a}=this,r=(I(e,t,n)-t)/(n-t);return I(a*Math.round(r*(s-o)/a)+o,o<s?o:s,s>o?s:o)}),this.step=1,this.domain=[0,1],this.range=[0,1]}}const C="undefined"!=typeof window&&"undefined"!=typeof document,b=()=>{},R=(e,t)=>e===t||e.length===t.length&&e.reduce((e=>(t,n,o)=>t&&e[o]===n)(t),!0),V=(e,t,n,o)=>{const s=o?e-t:e+t;return o?Math.max(n[0],s):Math.min(n[1],s)},L=(e,t,n,o)=>{const s=o?e+t:e-t;return o?Math.min(n[1],s):Math.max(n[0],s)};class $ extends t.PureComponent{constructor(...e){super(...e),a(this,"state",{step:null,values:null,domain:null,handles:[],reversed:null,activeHandleID:null,valueToPerc:null,valueToStep:null,pixelToStep:null}),a(this,"slider",n.createRef()),a(this,"onKeyDown",(e,t)=>{let n=["ArrowRight","ArrowUp"],o=["ArrowDown","ArrowLeft"];const{state:{handles:s},props:{step:a,reversed:r,vertical:i,domain:l}}=this,u=e.key||e.keyCode;if(!n.concat(o).includes(u))return;i&&([n,o]=[o,n]),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();const c=s.find(e=>e.key===t);if(!c)return;const h=c.val;let d=h;n.includes(u)?d=V(h,a,l,r):o.includes(u)&&(d=L(h,a,l,r));const p=s.map(e=>e.key===t?{key:e.key,val:d}:e);this.submitUpdate(p,!0)}),a(this,"onMouseDown",(e,t)=>{this.onStart(e,t,!1)}),a(this,"onTouchStart",(e,t)=>{f(e)||this.onStart(e,t,!0)}),a(this,"getEventData",(e,t)=>{const{state:{pixelToStep:n,valueToPerc:o},props:{vertical:s}}=this;let a;return n.setDomain(m(this.slider.current,s)),{value:a=t?n.getValue(g(s,e)):n.getValue(s?e.clientY:e.pageX),percent:o.getValue(a)}}),a(this,"onMouseMove",e=>{const{state:{handles:t,pixelToStep:n,activeHandleID:o},props:{vertical:s,reversed:a}}=this;n.setDomain(m(this.slider.current,s));const r=v(t,o,n.getValue(s?e.clientY:e.pageX),a);this.submitUpdate(r)}),a(this,"onTouchMove",e=>{const{state:{handles:t,pixelToStep:n,activeHandleID:o},props:{vertical:s,reversed:a}}=this;if(f(e))return;n.setDomain(m(this.slider.current,s));const r=v(t,o,n.getValue(g(s,e)),a);this.submitUpdate(r)}),a(this,"onMouseUp",()=>{const{state:{handles:e,activeHandleID:t},props:{onChange:n,onSlideEnd:o}}=this;n(e.map(e=>e.val)),o(e.map(e=>e.val),{activeHandleID:t}),this.setState({activeHandleID:null}),C&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp))}),a(this,"onTouchEnd",()=>{const{state:{handles:e,activeHandleID:t},props:{onChange:n,onSlideEnd:o}}=this;n(e.map(e=>e.val)),o(e.map(e=>e.val),{activeHandleID:t}),this.setState({activeHandleID:null}),C&&(document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))})}static getDerivedStateFromProps(e,t){const{step:n,values:o,domain:s,reversed:a,onUpdate:i,onChange:l,warnOnChanges:u}=e;let c=t.valueToPerc,h=t.valueToStep,p=t.pixelToStep;const v={};if(c&&h&&p||(c=new H,h=new P,p=new P,v.valueToPerc=c,v.valueToStep=h,v.pixelToStep=p),null===t.step||null===t.domain||null===t.reversed||n!==t.step||s[0]!==t.domain[0]||s[1]!==t.domain[1]||a!==t.reversed){const[e,m]=s;h.setStep(n).setRange([e,m]).setDomain([e,m]),!0===a?(c.setDomain([e,m]).setRange([100,0]),p.setStep(n).setRange([m,e])):(c.setDomain([e,m]).setRange([0,100]),p.setStep(n).setRange([e,m])),r(m>e,`${d} Max must be greater than min (even if reversed). Max is ${m}. Min is ${e}.`);const{handles:f,changes:g}=D(o||t.values,a,h,u);(g||void 0===o||o===t.values)&&(i(f.map(e=>e.val)),l(f.map(e=>e.val))),v.step=n,v.values=o,v.domain=s,v.handles=f,v.reversed=a}else if(!R(o,t.values)){const{handles:e,changes:t}=D(o,a,h,u);t&&(i(e.map(e=>e.val)),l(e.map(e=>e.val))),v.values=o,v.handles=e}return Object.keys(v).length?v:null}componentDidMount(){const{pixelToStep:e}=this.state,{vertical:t}=this.props;e.setDomain(m(this.slider.current,t))}componentWillUnmount(){this.removeListeners()}removeListeners(){C&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}onStart(e,t,n){const{state:{handles:o},props:{onSlideStart:s}}=this;n||e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),o.find(e=>e.key===t)?(this.setState({activeHandleID:t}),s(o.map(e=>e.val),{activeHandleID:t}),n?this.addTouchEvents():this.addMouseEvents()):(this.setState({activeHandleID:null}),this.handleRailAndTrackClicks(e,n))}handleRailAndTrackClicks(e,t){const{state:{handles:n,pixelToStep:o},props:{vertical:s,reversed:a}}=this,{slider:r}=this;let i;o.setDomain(m(r.current,s)),i=t?o.getValue(g(s,e)):o.getValue(s?e.clientY:e.pageX);let l=null,u=1/0;for(let e=0;e<n.length;e++){const{key:t,val:o}=n[e],s=Math.abs(o-i);s<u&&(l=t,u=s)}const c=v(n,l,i,a);this.setState({activeHandleID:l},()=>{this.submitUpdate(c,!0),t?this.addTouchEvents():this.addMouseEvents()})}addMouseEvents(){C&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}addTouchEvents(){C&&(document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",this.onTouchEnd))}submitUpdate(e,t){const{mode:n,step:o,onUpdate:s,onChange:a,reversed:i}=this.props,{getValue:l}=this.state.valueToStep;this.setState(({handles:u})=>{let c;if("function"==typeof n)c=n(u,e,o,i,l),r(Array.isArray(c),"Custom mode function did not return an array.");else switch(n){case 1:c=M(0,e);break;case 2:c=y(u,e);break;case 3:c=T(u,e,o,i,l);break;default:c=e,r(!1,`${d} Invalid mode value.`)}return s(c.map(e=>e.val)),t&&a(c.map(e=>e.val)),{handles:c}})}render(){const{state:{handles:e,valueToPerc:o,activeHandleID:a},props:{className:r,rootStyle:i,rootProps:d,component:p,disabled:v,flatten:m}}=this,f=e.map(({key:e,val:t})=>({id:e,value:t,percent:o.getValue(t)})),g=n.Children.map(this.props.children,e=>!e||e.type.name!==l.name&&e.type.name!==u.name&&e.type.name!==c.name&&e.type.name!==h.name?e:n.cloneElement(e,{scale:o,handles:f,activeHandleID:a,getEventData:this.getEventData,emitKeyboard:v?b:this.onKeyDown,emitMouse:v?b:this.onMouseDown,emitTouch:v?b:this.onTouchStart}));return m?n.createElement(t.Fragment,null,n.createElement(p,s({},d,{style:i,className:r,ref:this.slider})),g):n.createElement(p,s({},d,{style:i,className:r,ref:this.slider}),g)}}$.defaultProps={mode:1,step:.1,domain:[0,100],component:"div",rootProps:{},rootStyle:{},vertical:!1,reversed:!1,onChange:b,onUpdate:b,onSlideStart:b,onSlideEnd:b,disabled:!1,flatten:!1,warnOnChanges:!1},$.Rail=l,$.Ticks=u,$.Tracks=c,$.Handles=h,e.Handles=h,e.Rail=l,e.Slider=$,e.Ticks=u,e.Tracks=c,e.default=$,e.mode1=M,e.mode2=y,e.mode3=T,Object.defineProperty(e,"__esModule",{value:!0})});
